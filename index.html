<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>åœ–ç‰‡æª¢æŸ¥å·¥å…· Image Checker</title>
<style>
body{font-family:Arial,sans-serif;margin:0;padding:20px}
h1,h2,h3{margin-top:24px}
#dropZone{border:3px dashed #444;padding:40px;text-align:center;font-size:18px;margin-bottom:12px}
#dropZone.dragover{background:#f0f0f0}
.controls{margin-bottom:20px}
.controls button{margin-right:8px}
.section{margin-bottom:48px;padding-bottom:16px;border-bottom:1px dashed #ccc}
.grid-6{display:grid;grid-template-columns:repeat(6,1fr);gap:16px}
.image-card{border:1px solid #ddd;padding:8px;font-size:12px;border-radius:6px;background:#fafafa}
.image-card b{display:block;margin-bottom:4px;text-align:center}
.overlay-box{position:relative;width:100%;aspect-ratio:1/1;border:1px solid #aaa;background:#fdfdfd;border-radius:4px;cursor:pointer}
.overlay-box img{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;pointer-events:none}
.ok{color:green}.error{color:red}
#debug{position:fixed;bottom:0;left:0;right:0;background:#111;color:#0f0;font-size:12px;padding:4px 8px;z-index:9999;white-space:pre}
#viewer{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;z-index:10000}
#viewer .panel{position:relative;background:#111;border-radius:8px;padding:12px}
#viewer img{display:block;transform-origin:center center}
#viewer .close{position:absolute;top:6px;right:10px;color:#fff;cursor:pointer;font-size:18px}
#viewer .nav{position:absolute;top:50%;transform:translateY(-50%);color:#fff;font-size:28px;cursor:pointer;user-select:none}
#viewer .prev{left:-40px}
#viewer .next{right:-40px}
#viewer .hint{position:absolute;bottom:6px;left:10px;color:rgba(255,255,255,.6);font-size:11px}
</style>
</head>
<body>
<h1>åœ–ç‰‡æª¢æŸ¥å·¥å…·<br><span style="font-size:14px">Image Checker</span></h1>
<div id="dropZone">ğŸ‘‰ æ‹–å…¥åœ–ç‰‡ / å¤šå€‹è³‡æ–™å¤¾ / æ··åˆçš†å¯ï¼ˆChromeï¼‰<br><span style="font-size:14px">Drag images / folders here</span></div>
<div class="controls">
<button id="openFilesBtn">é¸å–åœ–ç‰‡<br><span style="font-size:12px">Select Images</span></button>
<button id="openFolderBtn">é¸å–è³‡æ–™å¤¾<br><span style="font-size:12px">Select Folder</span></button>
<input id="fileInput" type="file" multiple accept="image/*" hidden>
<input id="folderInput" type="file" webkitdirectory hidden>
</div>
<h2>ç³»åˆ—å®Œæ•´æ€§æª¢æŸ¥<br><span style="font-size:14px">Series Completeness</span></h2>
<div id="seriesCheck"></div>
<h2>ç–Šåˆæª¢æŸ¥<br><span style="font-size:14px">Overlay Check</span></h2>
<div id="overlayArea"></div>
<div id="debug"></div>
<div id="viewer">
  <div class="panel">
    <div class="close">âœ•</div>
    <div class="nav prev">â—€</div>
    <div class="nav next">â–¶</div>
    <img id="viewerImg">
    <div class="hint">æ»¾è¼ªç¸®æ”¾ï½œå·¦å³éµåˆ‡æ›ï½œEsc é—œé–‰<br>Mouse wheel to zoom Â· Arrow keys to navigate Â· Esc to close</div>
  </div>
</div>
<script>
const formatARegex=/^3([MW])[A-Za-z](\d{8})-ka-(g[1-6])$/i;
const formatBRegex=/^(g[1-6])$/i;
const GRID_G=["g1","g2","g4","g5","g6"];
const REQUIRED_G=["g1","g2","g3","g4","g5","g6"];
let images=[];let flatImages=[];let currentIndex=0;let scale=0.3;
function readEntry(entry){return new Promise(r=>{if(entry.isFile){entry.file(f=>r([f]))}else{const reader=entry.createReader();reader.readEntries(e=>Promise.all(e.map(readEntry)).then(x=>r(x.flat())))} })}
async function handleDrop(e){const dt=e.dataTransfer;const dbg=document.getElementById('debug');dbg.textContent=`items:${dt.items?.length||0}\nfiles:${dt.files?.length||0}`;if(dt.items&&dt.items.length){const entries=[...dt.items].map(i=>i.webkitGetAsEntry&&i.webkitGetAsEntry()).filter(Boolean);if(entries.length){const files=(await Promise.all(entries.map(readEntry))).flat();files.forEach(processFile);return}}if(dt.files&&dt.files.length){[...dt.files].forEach(processFile)}}
function processFile(file){if(!file.type.startsWith('image/'))return;const base=file.name.replace(/\.[^/.]+$/,'');let format='INVALID',g=null,seriesKey=null;let m=base.match(formatARegex);if(m){format='A';seriesKey=base.replace(/-ka-.+$/,'');g=m[3].toLowerCase()}else if(formatBRegex.test(base)){format='B';g=base.toLowerCase()}const url=URL.createObjectURL(file);images.push({name:base,displayName:base,format,g,seriesKey,url});render()}
function render(){overlayArea.innerHTML='';seriesCheck.innerHTML='';flatImages=[];const seriesMap={};images.filter(i=>i.format==='A').forEach(i=>{if(!seriesMap[i.seriesKey])seriesMap[i.seriesKey]=[];seriesMap[i.seriesKey].push(i)});Object.entries(seriesMap).forEach(([key,list])=>{const found=list.map(i=>i.g);const missing=REQUIRED_G.filter(g=>!found.includes(g));const div=document.createElement('div');div.innerHTML=`<b>${key}</b>ï¼š${missing.length?`<span class=error>ç¼ºå°‘ ${missing.join(', ')} (lack of ${missing.join(', ')})</span>`:`<span class=ok>âœ” å®Œæ•´ (Complete)</span>`}`;seriesCheck.appendChild(div)});Object.entries(seriesMap).forEach(([key,list])=>{const section=document.createElement('div');section.className='section';section.innerHTML=`<h3>${key}</h3><div class=grid-6></div>`;const grid=section.querySelector('.grid-6');GRID_G.forEach(g=>{const card=document.createElement('div');card.className='image-card';card.innerHTML=`<b>${g}</b><div class=overlay-box></div>`;const box=card.querySelector('.overlay-box');const b=images.find(i=>i.format==='B'&&i.g===g);if(b){box.innerHTML+=`<img src="${b.url}">`;flatImages.push(b)}list.filter(i=>i.g===g).forEach(i=>{box.innerHTML+=`<img src="${i.url}">`;flatImages.push(i)});box.addEventListener('click',()=>openViewer(flatImages.length-1));grid.appendChild(card)});overlayArea.appendChild(section)});}
const dropZone=document.getElementById('dropZone');dropZone.addEventListener('dragover',e=>{e.preventDefault();dropZone.classList.add('dragover')});dropZone.addEventListener('dragleave',()=>dropZone.classList.remove('dragover'));dropZone.addEventListener('drop',e=>{e.preventDefault();dropZone.classList.remove('dragover');handleDrop(e)});
const fileInput=document.getElementById('fileInput');const folderInput=document.getElementById('folderInput');openFilesBtn.onclick=()=>{fileInput.value='';fileInput.click()};openFolderBtn.onclick=()=>{folderInput.value='';folderInput.click()};fileInput.onchange=e=>[...e.target.files].forEach(processFile);folderInput.onchange=e=>[...e.target.files].forEach(processFile);
const viewer=document.getElementById('viewer');const viewerImg=document.getElementById('viewerImg');function openViewer(i){currentIndex=i;scale=0.3;updateViewer();viewer.style.display='flex'}function closeViewer(){viewer.style.display='none'}function updateViewer(){const img=flatImages[currentIndex];viewerImg.src=img.url;viewerImg.style.transform=`scale(${scale})`}viewer.querySelector('.close').onclick=closeViewer;viewer.querySelector('.prev').onclick=()=>{currentIndex=(currentIndex-1+flatImages.length)%flatImages.length;updateViewer()};viewer.querySelector('.next').onclick=()=>{currentIndex=(currentIndex+1)%flatImages.length;updateViewer()};viewer.addEventListener('wheel',e=>{e.preventDefault();scale+=e.deltaY<0?0.05:-0.05;scale=Math.max(0.1,Math.min(3,scale));updateViewer()});document.addEventListener('keydown',e=>{if(viewer.style.display!=='flex')return;if(e.key==='Escape')closeViewer();if(e.key==='ArrowLeft')viewer.querySelector('.prev').onclick();if(e.key==='ArrowRight')viewer.querySelector('.next').onclick()});
</script>
</body>
</html>
